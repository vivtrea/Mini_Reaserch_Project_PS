---
title: "Interim project"
output: html_notebook
---

Members: Daryna Horetska, Yaryna Pechenenko, Andrii Hovorov
Our dataset:
Multi-Resistance Antibiotic Susceptibility
https://www.kaggle.com/datasets/adilimadeddinehosni/multi-resistance-antibiotic-susceptibility
Our goal: to analyse bacteria resistance to different antibiotic depending on age, previous diseases, gender and etc.

Cleaning data:

```{r}
library(tidyr)
library(dplyr)
library(stringr)
library(ggplot2)


dataset_readed <- read.csv("Bacteria_dataset_Multiresictance.csv")

dataset_readed[dataset_readed == "?"] <- NA
dataset_readed[dataset_readed == "missing"] <- NA
dataset_readed[dataset_readed == "unknown"] <- NA
dataset_readed[dataset_readed == "error"] <- NA
dataset_readed[dataset_readed == "???"] <- NA
dataset_readed[dataset_readed == "??"] <- NA
dataset_readed[dataset_readed == ""] <- NA
dataset_readed[dataset_readed == "None"] <- NA
dataset_readed[dataset_readed == "null"] <- NA
dataset_readed <- dataset_readed %>% 
  separate(Souches, into = c("Strain_ID", "souche_description"), sep = " ", extra = "merge", fill = "right")
dataset_readed$souche_description <- tolower(dataset_readed$souche_description)
dataset_readed$souche_description <- trimws(dataset_readed$souche_description)

# Escherichia coli
dataset_readed$souche_description[dataset_readed$souche_description == "e coli"] <- "escherichia coli"
dataset_readed$souche_description[dataset_readed$souche_description == "e.coi"] <- "escherichia coli"
dataset_readed$souche_description[dataset_readed$souche_description == "e.cli"] <- "escherichia coli"
dataset_readed$souche_description[dataset_readed$souche_description == "e. coli"] <- "escherichia coli"

antibiotics <- c("AMX.AMP", "AMC", "CZ", "FOX", "CTX.CRO", "IPM", "GEN", "AN", "Acide.nalidixique", "ofx", "CIP", "C", "Co.trimoxazole", "Furanes", "colistine")

dataset_readed[antibiotics] <- lapply(dataset_readed[antibiotics], function(x) {
  x[x == "r"] <- "R"
  x[x == "intermediate"] <- "R"
  x[x == "Intermediate"] <- "R"
  x[x == "i"] <- "R"
  x[x == "s"] <- "S"
  x
})
```


```{r}
# Enterobacteria spp.
dataset_readed$souche_description[dataset_readed$souche_description == "spp. enteobacteria spp."] <- "enterobacteria spp."
dataset_readed$souche_description[dataset_readed$souche_description == "enter.bacteria"] <- "enterobacteria spp."
dataset_readed$souche_description[dataset_readed$souche_description == "enteobacteria spp."] <- "enterobacteria spp."
dataset_readed$souche_description[dataset_readed$souche_description == "enter.bacteria spp."] <- "enterobacteria spp."

# Klebsiella pneumoniae
dataset_readed$souche_description[dataset_readed$souche_description == "klbsiella pneumoniae"] <- "klebsiella pneumoniae"
dataset_readed$souche_description[dataset_readed$souche_description == "klebsie.lla pneumoniae"] <- "klebsiella pneumoniae"

# Proteus mirabilis
dataset_readed$souche_description[dataset_readed$souche_description == "protus mirabilis"] <- "proteus mirabilis"
dataset_readed$souche_description[dataset_readed$souche_description == "prot.eus mirabilis"] <- "proteus mirabilis"
dataset_readed$souche_description[dataset_readed$souche_description == "proeus mirabilis"] <- "proteus mirabilis"


dataset_readed <- na.omit(dataset_readed)



dataset_readed <- dataset_readed %>%
  separate(`age.gender`, into = c("age", "gender"), sep = "/", remove = FALSE)
```


```{r}
dataset_readed$age <- as.numeric(dataset_readed$age)

cat("Descriptive analysis of ages\n")
summary(dataset_readed$age)
cat("Infection frequency")
table(dataset_readed$Infection_Freq, useNA = "ifany")

```
```{r}
# n_distinct(dataset_readed$Souches)
```


```{r}
# dataset_readed %>% 
#   group_by(Souches) %>% 
#   filter(n() > 1)
```


```{r}
n_distinct(dataset_readed$souche_description)
```


```{r}
dataset_readed %>%
  count(souche_description, sort = TRUE) %>%
  ggplot(aes(x = reorder(souche_description, n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Frequency of Bacteria Species",
    x = "Bacteria (Species)",
    y = "Count"
  ) +
  theme_minimal()
```

Hypothesis:
```{r}
hist(dataset_readed$age,breaks = seq(min(dataset_readed$age,na.rm = TRUE), max(dataset_readed$age, na.rm = TRUE), by = 2), 
     col = "skyblue",      # fill color
     border = "white",     # border color
     main = "Distribution of Patient Ages",  # title
     xlab = "Age",         # x-axis label
     ylab = "Number of Patients")
```

```{r}
install.packages("nortest")
library(nortest)
ad.test(dataset_readed$age)
```


```{r}
ks.test(dataset_readed$age, "pnorm", mean = mean(dataset_readed$age), sd=sd(dataset_readed$age))
```

```{r}
shapiro.test(dataset_readed$age[dataset_readed$AMC == "R"])
shapiro.test(dataset_readed$age[dataset_readed$AMC == "S"])

```


1.
$H_0$: The mean age of patients with a resistant infection is equal to the mean age of patients with a susceptible infection
$H_1$: The mean age of patients with resistant infection is not equal to those with a susceptible infection


t-test because we don't know the theoretical variance (so we will compare $\mu_x$(average age for resistant cases) and $\mu_y$ (average age for susceptible cases))

```{r}

```

2.

$H_0$: diabetes has no impact on resistance to antibiotic
$H_1$: diabetes has impact on resistance to antibiotic


3. Continue to the previous
$H_0$: the effect of diabetes on resistance does not depend on the type of bacteria
$H_1$: the effect of diabetes on resistance does depend on the type of bacteria




